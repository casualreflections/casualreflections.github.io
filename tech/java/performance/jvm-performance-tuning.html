<!DOCTYPE html>
<html>
<!--
====================================================
 ____  _   _ _   ___     ___    _   _
| __ )| | | | | | \ \   / / \  | \ | |
|  _ \| |_| | | | |\ \ / / _ \ |  \| |
| |_) |  _  | |_| | \ V / ___ \| |\  |
|____/|_| |_|\___/   \_/_/   \_\_| \_|

====================================================
Owner Name: Bhuvan Rawal
Profile: https://www.facebook.com/bhu1rawal
Version: 1.1
Description: Awesome dude, awesome life
====================================================
-->
<head>
<meta charset="utf-8">
<title>Performance tuning for java applications &#8211; Bhuvan Rawal</title>
<meta name="description" content="Understand java heap and how to tune it">
<meta name="keywords" content="Tech, Java, Performance, Debugging">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/omikron.png">
<meta name="twitter:title" content="Performance tuning for java applications">
<meta name="twitter:description" content="Understand java heap and how to tune it">
<meta name="twitter:creator" content="@beingbhuvan">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Performance tuning for java applications">
<meta property="og:description" content="Understand java heap and how to tune it">
<meta property="og:url" content="/tech/java/performance/jvm-performance-tuning">
<meta property="og:site_name" content="Bhuvan Rawal">
<meta property="og:image" content="/images/default_bg1.jpg">





<link rel="canonical" href="/tech/java/performance/jvm-performance-tuning">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Bhuvan Rawal Feed">
<link rel="author" href="https://plus.google.com/u/0/115368800868963120427?rel=author">
<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />

<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search...">
        <i class="icon-remove-sign"></i>
        <ul class="search-results post-list"></ul><!-- /.search-results -->
    </div><!-- /.search-form -->
</div><!-- ./search-wrapper -->




<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>
<body class="post-template" itemscope itemtype="http://schema.org/WebPage">  
<div id="fade"></div>
<a id="slide" class="animated fade"></a>
<aside id="sidebar">
    <nav id="navigation">
    <h2>MENU</h2>
    <hr>

            <li>
                    <a href="/">Home</a>
                 </li>

            <li>
                    <a href="/categories">Categories</a>
                 </li>

            <li>
                    <a href="/tags">Tags</a>
                 </li>

            <li>
                    <a href="/about">Bhuvan who?</a>
                 </li>

            <li>
                    <a href="/contact">Contact me</a>
                 </li>

            <li>
                    <a href="/resume">Resume</a>
                 </li>
            
           <li><a href="/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
    </nav>
    
    
</aside>

<header id="masthead" class="blog-background overlay align-center align-middle animated from-bottom"  style="background-image: url(/images/default_bg1.jpg)" itemscope itemtype="http://schema.org/Organization">


    <button class="menu-button animated fade dosearch">
        <i class="icon-search"></i>
    </button>


    <div class="inner">
        <div class="container">
            <a class="brand" href="/" role="banner" itemprop="url">

                <img itemprop="logo" src="/images/omikron.png" alt="Bhuvan Rawal Logo" />

            <h1 class="blog-title light" itemprop="name">
                Bhuvan Rawal
            </h1>
                
            </a>
        </div>
    </div>
    
    
    <div class="decor-wrapper">
        <svg id="header-decor" class="decor bottom" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" preserveAspectRatio="none">
            <path class="large left" d="M0 0 L50 50 L0 100" fill="rgba(255,255,255, .1)"></path>
            <path class="large right" d="M100 0 L50 50 L100 100" fill="rgba(255,255,255, .1)"></path>

            <path class="medium left" d="M0 100 L50 50 L0 33.3" fill="rgba(255,255,255, .3)"></path>
            <path class="medium right" d="M100 100 L50 50 L100 33.3" fill="rgba(255,255,255, .3)"></path>

            <path class="small left" d="M0 100 L50 50 L0 66.6" fill="rgba(255,255,255, .5)"></path>
            <path class="small right" d="M100 100 L50 50 L100 66.6" fill="rgba(255,255,255, .5)"></path>

            <path d="M0 99.9 L50 49.9 L100 99.9 L0 99.9" fill="rgba(255,255,255, 1)"></path>

            <path d="M48 52 L50 49 L52 52 L48 52" fill="rgba(255,255,255, 1)"></path>

        </svg>
    </div>
    
</header>
<div id="main" class="content" role="main" itemprop="mainContentOfPage" itemscope itemtype="http://schema.org/Blog">
    <div class="container">
        <div class="row">
            <article class="post col-md-8 col-md-offset-2 hentry" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">

            
            
            
                    <header class="post-header entry-header">
                    <div class="cursive">this post is featured</div>
                        
                        <h1 class="post-title text-center hyper lighter bordered-bottom entry-title" itemprop="headline">Performance tuning for java applications</h1>
                        
                        <div class="cursive" style="color: #000; font-style:italic;">Understand java heap and how to tune it</div>
                        <div class="post-info text-center small">
                            <span class="entry-date date published updated"><time datetime="2017-09-09T19:52:58+05:30" class="post-time" itemprop="datePublished">09 Sep 2017</time><span>
                            in <span class="post-tags"><a href="/categories/index.html#TechJavaPerformance" data-toggle="tooltip" title="Other posts from the Tech category" rel="tag">Tech</a>&nbsp;&bull;&nbsp;<a href="/categories/index.html#TechJavaPerformance" data-toggle="tooltip" title="Other posts from the Java category" rel="tag">Java</a>&nbsp;&bull;&nbsp;<a href="/categories/index.html#TechJavaPerformance" data-toggle="tooltip" title="Other posts from the Performance category" rel="tag">Performance</a></span>&nbsp;<span class="post-tags"><i class="icon-time"></i>&nbsp;<span class="time">5.56</span> minutes read</span>
                        </div>
                    </header>
                    <div class="post-body bordered-bottom" itemprop="description">
                        
                        <p>It has been debated numerous times, what made java so special that it stood out of the park despite being invented in mid 90’s as compared to its high level heavy weights - C/C++.</p>

<p>One of the prominent reason for distinct popularity and rise to fame is portability of application i.e. compile once run everywhere. Agreed that was a critical aspect which lead to creation of the language, however one may ask this question - is it really as important in today’s paradigm with majority use cases of language belonging to server side on the cloud with consistent platforms? Probably portability isnt the most catchy feature afterall for server side apps, in today’s world.</p>

<p>The other important aspect is java gives the developer nearly complete independence from managing memory, while memory leaks are certainly possible but possibility is reduced to minimum and thereby the time to develop and test an application is comparatively far lesser. No long running tests to check for that catastrophic missed free() call! And no explicit pointers means avoidance of the dreaded segmentation fault!</p>

<p>The programmer declares memory on the heap and jvm assumes responsibility to free memory in a background process called garbage collection. While it is certainly a gift and makes java extremely less bug prone, it can lead to performance troubles if not understood and tuned appropriately, in this post we will try to understand how to tune a java application, understand the common jargons, avoid pitfalls and debug yourself out of one even if you fall into it.</p>

<h2 id="basics-of-jvm-heap">Basics of JVM Heap:</h2>
<p>Unlike C/C++/Python jvm maintains a max heap size beyond which it will not allow application to grow itself into this is called jvm parameter Xmx or MaxHeapSize. If not specified it is taken from default which can be found for your machine using <code>java -XX:+PrintFlagsFinal -version</code>. The jvm param Xms specifies the starting size of the heap which the jvm requests from OS to itself right at the beginning. As and when more memory is desired, jvm requests memory if possible from OS and allocates to itself till Xmx is reached.</p>

<p>When the garbage collector runs it causes the application threads to pause depending on the type of collector employed the pause can be short or quite long (the dreaded full GC).</p>

<p>There are several implementations of garbage collector algorithm like <strong>Serial Collector, Parallel GC, Parallel old gc, CMS, G1GC</strong>, etc. We will discuss default java8 implementation - Parallel collector for YoungGen &amp; CMS for OldGen.</p>

<p>Java heap is broadly divided into 3 parts, namely young gen, old gen &amp; reserved cache for code, etc. Young gen comprises of <strong>Eden space</strong> where new objects are allocated and 2 survivor spaces one of which is always empty. GC runs on young gen (eden + 1 used survivor) which is also reffered to as minor GC, the references which are old and are not in use are removed, the ones which are in use are transferred to remaining survivor space if it can fit in that space or promoted to old gen if either the age of objects has crossed the specified age limit or the size of used objects is more than the amount which can be fit in the empty survivor.</p>

<p>Its critical to understand why the algorithm is designed this way - in essence its to reduce the amount of space on which the GC algorithm operates on frequently. If we allow GC to run on full heap always and did not have a concept of old/yong gen we would have had long pauses leading to more unpredictable latencies and also there was a high probability of heap fragmentation - which is avoided by compacting collector. Majority of the times GC runs only on young gen allowing the application threads to run without large pauses.</p>

<h2 id="to-tune-your-baby-better---first-understand-it">To tune your baby better - first understand it</h2>
<p>One of the most common doubts people have while deploying server side java application is how much heap to allocate, what sould be the newGen/oldGen/survivorRatio, max pause times, etc.</p>

<p>While it is almost certain that there is no rule of thumb which can lead you to successful heap tuning(in kung fu panda terminology <code>There is no secret ingredient</code>), it is extremely critical to understand the kind of objects being allocated in order to determine the parameters. It is also important to have expectation of performance tuning activity either in terms of latency or throughput of application rarely ever can both be increased together.</p>

<p>For example - if improved latency is required, young gen size can be reduced. GC will run more frequently on young gen but application pauses will be short since the working set it will have to operate on will be less.</p>

<p>The larger heap you allocate, better the throughput will be in general but it will result in longer GC pauses as the algorithm will invariably run over larger memory space.</p>

<p>There are broadly 3 kinds of GC events - One on Young Gen, Minor GC as we have seen, CMS which operates on old gen and 3rd kind <strong>Full GC</strong>. Minor gc &amp; Major GC are forgiving as far as thread pauses are concerned with minor pauses lasting few milliseconds to no greater than 1 sec if things are working fine and parallelism is exploited well. The third GC event - dreaded <code>Full GC</code> runs when jvm has absolutely run out of heap in order to allocate more memory and it is not possible to go further without pausing complete application. Full GC runs on the entire heap and can pause a 10GB+ heap application for 15-30 seconds, even more.</p>

<h2 id="i-tried-hard-i-gave-my-best-tuning-strategy-but-my-app-ditched-me---that-dreaded-oom-error">I tried hard, I gave my best tuning strategy but my app ditched me - that dreaded OOM error</h2>

<p>From an ignorant perspective once an OOM strikes, the easiest way out would be to ignore it as an one off incident and restart the application. While that can solve the issue for that instant or probably some more but it cannot guarantee you sound sleep.</p>

<p>It is critical to enable heap dump on OOM error param of jvm in order to for the jvm to dump memory onto disk before killing itself and for you to have the ability to investigate what went wrong. For this two params need to be added <code>-XX:+HeapDumpOnOutOfMemoryError</code> and path of dump file generated <code>-XX:HeapDumpPath=/Users/bhuvanrawal/heap_dump/</code></p>

<p>Usually -server flag is good enough for jvm to optimise.</p>

<p>java -Xmx100m -XX:SurvivorRatio=1 -XX:+PrintGCDetails -XX:+PrintTenuringDistribution -XX:+PrintGCDateStamps -XX:+UseParallelGC -XX:HeapDumpPath=/Users/bhuvanrawal/git/testModule/src/main/java/test -XX:+HeapDumpOnOutOfMemoryError App</p>

<p>DisableExplicitGC - disable system.gc() - it runs a full gc everytime
CMSInitiatingOccupancyFraction - at what percentage should CMS kick in
UseCMSInitiatingOccupancyOnly - prevents gc heretics and kicks in at CMSInitiatingOccupancyFraction
-XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=10 -XX:GCLogFileSize=100M</p>

                        <br>
                    
                    
                    <div class="entry-tags text-center">
                    
                        <i class="icon-tags"></i>&nbsp;Tagged with <a href="/tags/index.html#Tech" data-toggle="tooltip" title="Posts tagged with Tech" rel="tag">Tech</a>&nbsp;&bull;&nbsp;<a href="/tags/index.html#Java" data-toggle="tooltip" title="Posts tagged with Java" rel="tag">Java</a>&nbsp;&bull;&nbsp;<a href="/tags/index.html#Performance" data-toggle="tooltip" title="Posts tagged with Performance" rel="tag">Performance</a>&nbsp;&bull;&nbsp;<a href="/tags/index.html#Debugging" data-toggle="tooltip" title="Posts tagged with Debugging" rel="tag">Debugging</a>
                    
                    </div>
                    
                    </div>
        </div>
                    <footer class="post-footer entry-meta">
                        <div class="post-share text-center">
    <p class="light small">
        Share this post
    </p>
    <ul class="social-mini">
        <li>
            <a href="https://twitter.com/intent/tweet?text=&quot;Performance tuning for java applications&quot;%20/tech/java/performance/jvm-performance-tuning%20via%20&#64;beingbhuvan"
            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" data-toggle="tooltip" title="Share on Twitter" itemprop="Twitter">
                <i class="icon-twitter"></i>
            </a>
        </li>
        <li>
            <a  href="https://www.facebook.com/sharer/sharer.php?u=/tech/java/performance/jvm-performance-tuning"
            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" data-toggle="tooltip" title="Share on Facebook" itemprop="Facebook">
                <i class="icon-facebook"></i>
            </a>
        </li>
        <li>
            <a href="https://plus.google.com/share?url=/tech/java/performance/jvm-performance-tuning"
           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" data-toggle="tooltip" title="Share on Google plus" itemprop="GooglePlus">
                <i class="icon-google-plus"></i>
            </a>
        </li>
    </ul>
</div>
                        <div class="post-author text-center">                       
	        <img src="/images/bhuvanrawal.jpg" alt="Bhuvan Rawal's photo" itemprop="image" class="post-avatar img-circle img-responsive"/>    
	    <h4 class="bordered-bottom vcard author" itemprop="author" itemscope itemtype="http://schema.org/Person">By <span itemprop="name" class="fn"><a href="/about" title="About Bhuvan Rawal" itemprop="url">Bhuvan Rawal</a></span></h4>
	    <p>Bhuvan Rawal is a Computer Science engineer based in New Delhi, India. His interests are anything that&#8217;s related to Technology and Science, from math to programming languages to music to physics to engineering to philosophy.</p>
</div> 
                        <div id="disqus_thread"></div><!-- /#disqus_thread -->
                    </footer>
            </article>
    </div>
</div>

<footer id="footer"  class="blog-background overlay text-center align-middle animated from-top" style="background-image: url(/images/default_bg1.jpg)" >


    <div class="inner">
        <div class="container">

            <ul class="social-icons">
            <li>
                <a href="http://twitter.com/beingbhuvan" data-toggle="tooltip" title="Bhuvan Rawal on Twitter" target="_blank">
                    <i class="icon-twitter"></i>
                </a>
            </li>
            <li>
                <a href="http://facebook.com/bhu1rawal" data-toggle="tooltip" title="Bhuvan Rawal on Facebook" target="_blank">
                    <i class="icon-facebook"></i>
                </a>
            </li>
            <li>
                <a href="https://plus.google.com/u/0/115368800868963120427" data-toggle="tooltip" title="Bhuvan Rawal on Google+" target="_blank">
                    <i class="icon-google-plus"></i>
                </a>
            </li>
            <li>
                <a href="https://stackexchange.com/users/4482379/bhuvan-rawal" data-toggle="tooltip" title="Bhuvan Rawal on StackExchange" target="_blank">
                    <i class="icon-stackexchange"></i>
                </a>
            </li>
            <li>
                <a href="https://in.linkedin.com/in/bhuvanrawal" data-toggle="tooltip" title="Bhuvan Rawal on LinkedIn" target="_blank">
                    <i class="icon-linkedin"></i>
                </a>
            </li>
            
            
            <li>
                <a href="http://github.com/bhuvanrawal" data-toggle="tooltip" title="Bhuvan Rawal on Github" target="_blank">
                    <i class="icon-github"></i>
                </a>
            </li>
        </ul>
            <div>
                <a href="/about/">Bhuvan Rawal</a> &copy; 2017 &bull; All rights reserved.
            </div>
            <ul class="menu-items">
            
            <li>
                
                    <a href="/"><i class="icon-home"></i></a>&nbsp;&bull;
                 
            </li>
            
            <li>
                
                    <a href="/categories">Categories</a>&nbsp;&bull;
                 
            </li>
            
            <li>
                
                    <a href="/tags">Tags</a>&nbsp;&bull;
                 
            </li>
            
            <li>
                
                    <a href="/about">Bhuvan who?</a>&nbsp;&bull;
                 
            </li>
            
            <li>
                
                    <a href="/contact">Contact me</a>&nbsp;&bull;
                 
            </li>
            
            <li>
                
                    <a href="/resume">Resume</a>&nbsp;&bull;
                 
            </li>
            
            <li><a href="/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
        </ul>
        </div>
    </div>
    
        <div class="decor-wrapper">
            <svg id="footer-decor" class="decor top" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" preserveAspectRatio="none">

                <path class="large left" d="M0 0 L50 50 L0 100" fill="rgba(255,255,255, .1)"></path>
                <path class="large right" d="M100 0 L50 50 L100 100" fill="rgba(255,255,255, .1)"></path>

                <path class="medium left" d="M0 0 L50 50 L0 66.6" fill="rgba(255,255,255, .3)"></path>
                <path class="medium right" d="M100 0 L50 50 L100 66.6" fill="rgba(255,255,255, .3)"></path>

                <path class="small left" d="M0 0 L50 50 L0 33.3" fill="rgba(255,255,255, .5)"></path>
                <path class="small right" d="M100 0 L50 50 L100 33.3" fill="rgba(255,255,255, .5)"></path>

                <path d="M0 0 L50 50 L100 0 L0 0" fill="rgba(255,255,255, 1)"></path>

                <path d="M48 48 L50 51 L52 48 L48 48" fill="rgba(255,255,255, 1)"></path>

            </svg>
        </div>
    

</footer>

    
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>
<script type="text/javascript" src="/assets/js/waypoints.min.js"></script>
<script type="text/javascript" src="/assets/js/script.js"></script>
<script type='text/javascript'>$(document).ready(function(){$(".time").text(function(a,b){return Math.round(parseFloat(b))})});</script>

<script type="text/javascript" src="/assets/js/custom.js"></script>

<script type="text/javascript">

/*      Slides       */

$("a#slide").click(function(){
    $("#sidebar,body,a#slide,#fade").addClass("slide")
});

$("#fade,#header,#posts-container").click(function(){
    $("#sidebar,body,a#slide,#fade").removeClass("slide")
});

$("a#click-filter").click(function(){
    $("#slide-filter").slideToggle("medium");
    $("#slide-pages").slideOut("medium");
});

$("a#click-pages").click(function(){
    $("#slide-pages").slideToggle("medium");
    $("#slide-filter").slideOut("medium");
});

/*      End-Slides      */

</script>


<!-- Jekyll Simple Search option -->
<script>
  $(document).ready(function() {
      $('.search-field').simpleJekyllSearch({
          jsonFile : '/search.json',
          searchResults : '.search-results',
          template : '<li><article><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></article></li>',
          noResults: '<p>Nothing found.</p>'
        });
  });

  (function( $, window, undefined ) {
    
     var bs = {
          close: $(".icon-remove-sign"),
          searchform: $(".search-form"),
          canvas: $("body"),
          dothis: $('.dosearch')
      };
    
    bs.dothis.on('click', function() {
      $('.search-wrapper').css({ display: "block" });
      bs.searchform.toggleClass('active');
      bs.searchform.find('input').focus();
      bs.canvas.toggleClass('search-overlay');
    });
    
      bs.close.on('click', function() {
        $('.search-wrapper').removeAttr( 'style' );
        bs.searchform.toggleClass('active');
        bs.canvas.removeClass('search-overlay');
    });
  })( jQuery, window );
</script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl = 
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-58286706-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'bhuvanrawal'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
 
</body>
</html>
