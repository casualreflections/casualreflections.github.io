<!DOCTYPE html>
<html>
<!--
====================================================
 ____  _   _ _   ___     ___    _   _
| __ )| | | | | | \ \   / / \  | \ | |
|  _ \| |_| | | | |\ \ / / _ \ |  \| |
| |_) |  _  | |_| | \ V / ___ \| |\  |
|____/|_| |_|\___/   \_/_/   \_\_| \_|

====================================================
Owner Name: Bhuvan Rawal
Profile: https://www.facebook.com/bhu1rawal
Version: 1.1
Description: Awesome dude, awesome life
====================================================
-->
<head>
<meta charset="utf-8">
<title>JMX & Cassandra - Maintaining & Monitoring at Scale &#8211; Bhuvan Rawal</title>
<meta name="description" content="Monitor and Administer cassandra using jmx">
<meta name="keywords" content="Tech, Cassandra, JMX, Monitoring, Administration, Java">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/omikron.png">
<meta name="twitter:title" content="JMX & Cassandra - Maintaining & Monitoring at Scale">
<meta name="twitter:description" content="Monitor and Administer cassandra using jmx">
<meta name="twitter:creator" content="@beingbhuvan">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="JMX & Cassandra - Maintaining & Monitoring at Scale">
<meta property="og:description" content="Monitor and Administer cassandra using jmx">
<meta property="og:url" content="/tech/cassandra/jmx/monitoring/administration/java/Cassandra-JMX">
<meta property="og:site_name" content="Bhuvan Rawal">
<meta property="og:image" content="/images/default_bg1.jpg">





<link rel="canonical" href="/tech/cassandra/jmx/monitoring/administration/java/Cassandra-JMX">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Bhuvan Rawal Feed">
<link rel="author" href="https://plus.google.com/u/0/115368800868963120427?rel=author">
<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />

<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search...">
        <i class="icon-remove-sign"></i>
        <ul class="search-results post-list"></ul><!-- /.search-results -->
    </div><!-- /.search-form -->
</div><!-- ./search-wrapper -->




<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>
<body class="post-template" itemscope itemtype="http://schema.org/WebPage">  
<div id="fade"></div>
<a id="slide" class="animated fade"></a>
<aside id="sidebar">
    <nav id="navigation">
    <h2>MENU</h2>
    <hr>

            <li>
                    <a href="/">Home</a>
                 </li>

            <li>
                    <a href="/categories">Categories</a>
                 </li>

            <li>
                    <a href="/tags">Tags</a>
                 </li>

            <li>
                    <a href="/about">Bhuvan who?</a>
                 </li>

            <li>
                    <a href="/contact">Contact me</a>
                 </li>

            <li>
                    <a href="/resume">Resume</a>
                 </li>
            
           <li><a href="/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
    </nav>
    
    
</aside>

<header id="masthead" class="blog-background overlay align-center align-middle animated from-bottom"  style="background-image: url(/images/default_bg1.jpg)" itemscope itemtype="http://schema.org/Organization">


    <button class="menu-button animated fade dosearch">
        <i class="icon-search"></i>
    </button>


    <div class="inner">
        <div class="container">
            <a class="brand" href="/" role="banner" itemprop="url">

                <img itemprop="logo" src="/images/omikron.png" alt="Bhuvan Rawal Logo" />

            <h1 class="blog-title light" itemprop="name">
                Bhuvan Rawal
            </h1>
                
            </a>
        </div>
    </div>
    
    
    <div class="decor-wrapper">
        <svg id="header-decor" class="decor bottom" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" preserveAspectRatio="none">
            <path class="large left" d="M0 0 L50 50 L0 100" fill="rgba(255,255,255, .1)"></path>
            <path class="large right" d="M100 0 L50 50 L100 100" fill="rgba(255,255,255, .1)"></path>

            <path class="medium left" d="M0 100 L50 50 L0 33.3" fill="rgba(255,255,255, .3)"></path>
            <path class="medium right" d="M100 100 L50 50 L100 33.3" fill="rgba(255,255,255, .3)"></path>

            <path class="small left" d="M0 100 L50 50 L0 66.6" fill="rgba(255,255,255, .5)"></path>
            <path class="small right" d="M100 100 L50 50 L100 66.6" fill="rgba(255,255,255, .5)"></path>

            <path d="M0 99.9 L50 49.9 L100 99.9 L0 99.9" fill="rgba(255,255,255, 1)"></path>

            <path d="M48 52 L50 49 L52 52 L48 52" fill="rgba(255,255,255, 1)"></path>

        </svg>
    </div>
    
</header>
<div id="main" class="content" role="main" itemprop="mainContentOfPage" itemscope itemtype="http://schema.org/Blog">
    <div class="container">
        <div class="row">
            <article class="post col-md-8 col-md-offset-2 hentry" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">

            
            
            
                    <header class="post-header entry-header">
                    <div class="cursive">this post is featured</div>
                        
                        <h1 class="post-title text-center hyper lighter bordered-bottom entry-title" itemprop="headline">JMX & Cassandra - Maintaining & Monitoring at Scale</h1>
                        
                        <div class="cursive" style="color: #000; font-style:italic;">Monitor and Administer cassandra using jmx</div>
                        <div class="post-info text-center small">
                            <span class="entry-date date published updated"><time datetime="2016-09-19T02:52:58+05:30" class="post-time" itemprop="datePublished">19 Sep 2016</time><span>
                            in <span class="post-tags"><a href="/categories/index.html#TechCassandraJMXMonitoringAdministrationJava" data-toggle="tooltip" title="Other posts from the Tech category" rel="tag">Tech</a>&nbsp;&bull;&nbsp;<a href="/categories/index.html#TechCassandraJMXMonitoringAdministrationJava" data-toggle="tooltip" title="Other posts from the Cassandra category" rel="tag">Cassandra</a>&nbsp;&bull;&nbsp;<a href="/categories/index.html#TechCassandraJMXMonitoringAdministrationJava" data-toggle="tooltip" title="Other posts from the Jmx category" rel="tag">Jmx</a>&nbsp;&bull;&nbsp;<a href="/categories/index.html#TechCassandraJMXMonitoringAdministrationJava" data-toggle="tooltip" title="Other posts from the Monitoring category" rel="tag">Monitoring</a>&nbsp;&bull;&nbsp;<a href="/categories/index.html#TechCassandraJMXMonitoringAdministrationJava" data-toggle="tooltip" title="Other posts from the Administration category" rel="tag">Administration</a>&nbsp;&bull;&nbsp;<a href="/categories/index.html#TechCassandraJMXMonitoringAdministrationJava" data-toggle="tooltip" title="Other posts from the Java category" rel="tag">Java</a></span>&nbsp;<span class="post-tags"><i class="icon-time"></i>&nbsp;<span class="time">10.96</span> minutes read</span>
                        </div>
                    </header>
                    <div class="post-body bordered-bottom" itemprop="description">
                        
                        <blockquote>
  <p>Thanks to Jeff Carpenter &amp; Eben Hewitt. A lot of this work draws inspiration from their book <code>Cassandra: The Definitive Guide</code></p>
</blockquote>

<blockquote>
  <p>JMX (Java Management Extensions - JSR 262)  Provides tools for web based, modular extensions for monitoring java based applications. Starting with Java 5 JMX is plugged into Java SE.</p>
</blockquote>

<blockquote>
  <p>JMX helps monitor java application in two key ways 1. It helps understand app health in terms of memory, heap, cpu usage, threads, garbage collection, etc. Secondly, JMX allows you to work with specific aspects of app through instrumentation, i.e. putting wrapper in application code in order to allow JVM to gather data that external tool can use.
More on JMX can be obtained by going through java.lang.management package</p>
</blockquote>

<blockquote>
  <p>Being a Storage Server it becomes critical to provide means to expose metrics as well as a way to change node config during runtime without restarting the node. JMX quite easily is the preferred choice as its pretty extensible, as compared to SNMP which is not very extensible and can only expose what is provided in that MIB.</p>
</blockquote>

<h2 id="overview-of-mbeans">Overview of MBeans:</h2>

<p>A managed bean or MBean is a special type of Java Bean that represents a single manageable resource inside the JVM. MBeans interact with an MBean server to make their functions remotely available. When an MBean is registered with the MBean server, it specifies an object name that is used to identify the MBean to JMX clients. An object name consists of a domain followed by a list of key-value pairs, atleast one of which must identify a type. Typical convention is to use chose a domain name that is similar to the Java package name of the MBean, and to name the type after MBean interface name.</p>

<p>Some simple values in application are exposed as attributes for example attribute PeakThreadCount of Threading Bean, which stores the greatest number of threads present in application at anytime since startup. Other MBeans are configurable for example JMXConfigurator bean in logback is configurable and loglevel can be altered at runtime using method setLoggerLevel <code>nodetool setlogginglevel/getlogginglevels</code> internally calls this functionality for getting &amp; setting loglevels.</p>

<p>Another type of MBean operation is one that doesnt simply show a value, but lets you execute some useful action. dumpAllThreads and resetPeakThreadCount are two such operations.</p>

<h2 id="cassandra-mbeans-">Cassandra MBeans :</h2>
<p>Once connected with a jmx client like JConsole / Java Mission Control the MBeans can be managed. Cassandra’s beans are organized in packages which start with <code>org.apache.cassandra</code>, one such example that can be looked over here is CompactionManagerMbean interface:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cassandra</span><span class="o">.</span><span class="na">db</span><span class="o">.</span><span class="na">compaction</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.management.openmbean.TabularData</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CompactionManagerMBean</span>
<span class="o">{</span>
    <span class="cm">/** List of running compaction objects. */</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;&gt;</span> <span class="nf">getCompactions</span><span class="o">();</span>

    <span class="cm">/** List of running compaction summary strings. */</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getCompactionSummary</span><span class="o">();</span>

    <span class="cm">/** compaction history **/</span>
    <span class="kd">public</span> <span class="n">TabularData</span> <span class="nf">getCompactionHistory</span><span class="o">();</span>

    <span class="cm">/**</span>
<span class="cm">     * Triggers the compaction of user specified sstables.</span>
<span class="cm">     * You can specify files from various keyspaces and columnfamilies.</span>
<span class="cm">     * If you do so, user defined compaction is performed several times to the groups of files</span>
<span class="cm">     * in the same keyspace/columnfamily.</span>
<span class="cm">     *</span>
<span class="cm">     * @param dataFiles a comma separated list of sstable file to compact.</span>
<span class="cm">     *                  must contain keyspace and columnfamily name in path(for 2.1+) or file name itself.</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">forceUserDefinedCompaction</span><span class="o">(</span><span class="n">String</span> <span class="n">dataFiles</span><span class="o">);</span>

    <span class="cm">/**</span>
<span class="cm">     * Triggers the cleanup of user specified sstables.</span>
<span class="cm">     * You can specify files from various keyspaces and columnfamilies.</span>
<span class="cm">     * If you do so, cleanup is performed each file individually</span>
<span class="cm">     *</span>
<span class="cm">     * @param dataFiles a comma separated list of sstable file to cleanup.</span>
<span class="cm">     *                  must contain keyspace and columnfamily name in path(for 2.1+) or file name itself.</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">forceUserDefinedCleanup</span><span class="o">(</span><span class="n">String</span> <span class="n">dataFiles</span><span class="o">);</span>


    <span class="cm">/**</span>
<span class="cm">     * Stop all running compaction-like tasks having the provided {@code type}.</span>
<span class="cm">     * @param type the type of compaction to stop. Can be one of:</span>
<span class="cm">     *   - COMPACTION</span>
<span class="cm">     *   - VALIDATION</span>
<span class="cm">     *   - CLEANUP</span>
<span class="cm">     *   - SCRUB</span>
<span class="cm">     *   - INDEX_BUILD</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stopCompaction</span><span class="o">(</span><span class="n">String</span> <span class="n">type</span><span class="o">);</span>

    <span class="cm">/**</span>
<span class="cm">     * Stop an individual running compaction using the compactionId.</span>
<span class="cm">     * @param compactionId Compaction ID of compaction to stop. Such IDs can be found in</span>
<span class="cm">     *                     the transaction log files whose name starts with compaction_,</span>
<span class="cm">     *                     located in the table transactions folder.</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stopCompactionById</span><span class="o">(</span><span class="n">String</span> <span class="n">compactionId</span><span class="o">);</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns core size of compaction thread pool</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCoreCompactorThreads</span><span class="o">();</span>

    <span class="cm">/**</span>
<span class="cm">     * Allows user to resize maximum size of the compaction thread pool.</span>
<span class="cm">     * @param number New maximum of compaction threads</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCoreCompactorThreads</span><span class="o">(</span><span class="kt">int</span> <span class="n">number</span><span class="o">);</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns maximum size of compaction thread pool</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getMaximumCompactorThreads</span><span class="o">();</span>

    <span class="cm">/**</span>
<span class="cm">     * Allows user to resize maximum size of the compaction thread pool.</span>
<span class="cm">     * @param number New maximum of compaction threads</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMaximumCompactorThreads</span><span class="o">(</span><span class="kt">int</span> <span class="n">number</span><span class="o">);</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns core size of validation thread pool</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCoreValidationThreads</span><span class="o">();</span>

    <span class="cm">/**</span>
<span class="cm">     * Allows user to resize maximum size of the compaction thread pool.</span>
<span class="cm">     * @param number New maximum of compaction threads</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCoreValidationThreads</span><span class="o">(</span><span class="kt">int</span> <span class="n">number</span><span class="o">);</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns size of validator thread pool</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getMaximumValidatorThreads</span><span class="o">();</span>

    <span class="cm">/**</span>
<span class="cm">     * Allows user to resize maximum size of the validator thread pool.</span>
<span class="cm">     * @param number New maximum of validator threads</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMaximumValidatorThreads</span><span class="o">(</span><span class="kt">int</span> <span class="n">number</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<p>The class <code>CompactionManager</code> implements this bean, it is exposed in the domain org.apache.cassandra.db under CompactionManager in jmx clients. It does all the work that it is intended to do, and has implementation of methods that are only necessary for talking to the MBean server. Here is how the CompactionManager registers itself in a static block as can be seen below:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CompactionManager</span> <span class="kd">implements</span> <span class="n">CompactionManagerMBean</span>
<span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">MBEAN_OBJECT_NAME</span> <span class="o">=</span> <span class="s">&quot;org.apache.cassandra.db:type=CompactionManager&quot;</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">CompactionManager</span> <span class="n">instance</span><span class="o">;</span>
    <span class="o">.......</span>

    <span class="kd">static</span>
    <span class="o">{</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">CompactionManager</span><span class="o">();</span>
        <span class="n">MBeanServer</span> <span class="n">mbs</span> <span class="o">=</span> <span class="n">ManagementFactory</span><span class="o">.</span><span class="na">getPlatformMBeanServer</span><span class="o">();</span>
        <span class="k">try</span>
        <span class="o">{</span>
            <span class="n">mbs</span><span class="o">.</span><span class="na">registerMBean</span><span class="o">(</span><span class="n">instance</span><span class="o">,</span> <span class="k">new</span> <span class="nf">ObjectName</span><span class="o">(</span><span class="n">MBEAN_OBJECT_NAME</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span>
        <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Stop all running compaction-like tasks having the provided {@code type}.</span>
<span class="cm">     * @param type the type of compaction to stop. Can be one of:</span>
<span class="cm">     *   - COMPACTION</span>
<span class="cm">     *   - VALIDATION</span>
<span class="cm">     *   - CLEANUP</span>
<span class="cm">     *   - SCRUB</span>
<span class="cm">     *   - INDEX_BUILD</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stopCompaction</span><span class="o">(</span><span class="n">String</span> <span class="n">type</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="n">OperationType</span> <span class="n">operation</span> <span class="o">=</span> <span class="n">OperationType</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">type</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Holder</span> <span class="n">holder</span> <span class="o">:</span> <span class="n">CompactionMetrics</span><span class="o">.</span><span class="na">getCompactions</span><span class="o">())</span>
        <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">holder</span><span class="o">.</span><span class="na">getCompactionInfo</span><span class="o">().</span><span class="na">getTaskType</span><span class="o">()</span> <span class="o">==</span> <span class="n">operation</span><span class="o">)</span>
                <span class="n">holder</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stopCompactionById</span><span class="o">(</span><span class="n">String</span> <span class="n">compactionId</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Holder</span> <span class="n">holder</span> <span class="o">:</span> <span class="n">CompactionMetrics</span><span class="o">.</span><span class="na">getCompactions</span><span class="o">())</span>
        <span class="o">{</span>
            <span class="n">UUID</span> <span class="n">holderId</span> <span class="o">=</span> <span class="n">holder</span><span class="o">.</span><span class="na">getCompactionInfo</span><span class="o">().</span><span class="na">compactionId</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">holderId</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">holderId</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="n">compactionId</span><span class="o">)))</span>
                <span class="n">holder</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="o">.......</span></code></pre></figure>

<h2 id="cassandra-db-mbeans">Cassandra DB MBeans:</h2>

<h3 id="storageservicembean">StorageServiceMBean</h3>

<p>As cassandra is a database software, the first places to look in case of an issue is org.apache.cassandra.service.StorageServiceMBean, this allows you to see operation mode which is either of : <code>leaving, joining, decommissioned and client</code>. The set of live and unreachable nodes can also be found here.</p>

<p>To change the loglevel at runtime setLogLevel can be invoked. To get amount of data stored per node, getLoadMap() method can be invoked which presents a java map with key as ip address as node and value as corresponding storage load. Also effective ownership operation can be used to access the percentage of data in a keyspace owned by each node.</p>

<p>In order to find the node ownership of a partition key getNaturalEndpoints(String table, byte[] key) can be used. StorageServiceMBean offers many other maintenance operations like resumeBootstrap, joinRing, repairAsync, drain, removeNode, decommission and operations to start and stop gossip.</p>

<h3 id="storageproxymbean">StorageProxyMBean:</h3>
<p>The <code>org.apache.cassandra.service.StorageProxy</code> provides a layer on top of StorageService to handle client requests and inter node communications. The StorageProxyMBean provides the ability to check and set timeout values for various operations including read and write.</p>

<p>This MBean also provides access to hinted handoff settings such as the maximum time window for storing hints. Hinted handoff statistics include getTotalHints, and getHintsInProgress. This can be disabled with the disableHintsForDC operation.</p>

<p>A particular nodes hints can be disabled via setHintedHandoffEnabled and status can be checked via getHintedHandoffEnabled. These are used by <code>nodetool enablehandoff / disablehandoff / statushandoff</code> commands. realoadTriggerClasses allows to install a new trigger without having to restart a node.</p>

<h3 id="columnfamilystorembean">ColumnFamilyStoreMBean</h3>
<p>The table stats of cassandra are stored in org.apache.cassandr.db &gt; Tables (Which previously was ColumnFamilies). This MBean provides access to compaction and compression stats for each table. This allows to temporarily override the setting on specific node. The values will be reset to those configured on the table schema when the node is restarted.</p>

<p>The MBean also exposes a lot of information about the node’s storage of data for this table on disk. The getSSTableCountPerLevel() operation provides a list of how many sstables are in each tier. The estimateKeys() operation provides an estimate of number of partition stored on the node. Taken together this information can give some insight whether forceMajorCompaction operation for this table might help free up space and increase read performance.</p>

<p>There is also trueSnapshotSize method which allows finding the size of snapshots which are no longer valid. As cassandra stores indexes in tables, there is a ColumnFamilyStoreMBean instance for each indexed column available under IndexTables.</p>

<h3 id="cacheservicembean">CacheServiceMBean</h3>
<p>The <code>org.apache.cassandra.service.CacheServiceMBean</code> provides access to Cassandra’s key cache, row cache and counter cache under the domain name <code>org.apache.cassandra.db</code> &gt; Caches. The info available for each caches includes maximum size and time duration to cache items and ability to invalidate each cache.</p>

<h3 id="commitlogmbean">CommitLogMBean</h3>
<p>The <code>org.apache.cassandra.db.commitlog.CommitLogMBean</code> exposes attributes and operations that allow you to learn about the current state of commit logs. Default commitlog configuratios are defined in conf/commitlog_archiving.properties but can be overrided via MBean.</p>

<h3 id="compactionmanagermbean">CompactionManagerMBean</h3>
<p><code>org.apache.cassandra.db.CompactionManagerMBean</code> allows to get stats about compactions performed in the past and the ability to perform compactions of specific SSTable files we identify by calling the forceUserDefinedCompaction method of the CompactionManager class.</p>

<p>This MBean is leveraged by nodetool commands including compact, compactionhistory, and compactionstats.</p>

<h3 id="snitchmbeans">SnitchMBeans</h3>
<p>Two MBeans are provided by cassandra to monitor and configure behaviour of snitch. The ``org.apache.cassandra.locator.EndpointSnitchInfoMBean` provides the name of the rack and data center for a given host, as well as the name of the snitch in use.</p>

<p>If DynamicEndpointSnitch is being used, the ``org.apache.cassandra.locator.DynamicEndpointSnitchMBean` is registered, this MBean exposes the ability to reset the badness threshold used by the snitch for making nodes as offline, as well as allowing you to see the scores of various nodes.</p>

<h3 id="hintedhandoffmanagermbean">HintedHandoffManagerMBean</h3>
<p>Cassandra provides fine grained control of hinted handoff via <code>org.apache.cassandra.db.HintedHandoffManagerMBean</code>, the MBean exposes the ability to list nodes for which hints are stored by calling listEndpointsPendingHints(). You can then force delivery by calling scheduleHintDelivery() or delete hints via deleteHintsForEndpoint().</p>

<p>Additionally, you can pause and resume hint delivery to all nodes with pauseHintDelivery or delete stored hints for all nodes with the truncateAllHints operation. These are used by <code>nodetool's pausehandoff, resumehandoff and truncatehints</code>.</p>

<h3 id="networking-mbeans">Networking MBeans</h3>

<p>The <code>org.apache.cassandra.net</code> domain contains MBeans to help cassandra manage Cassandra’s network related activities includin phi failure detection and gossip, the Message Service, and Stream Manager.</p>

<h3 id="failuredetectormbean">FailureDetectorMBean</h3>
<p>The <code>org.apache.cassandra.gms.FailureDetectorMBean</code> provides attributes describing the states and Phi scores of other nodes as well as the Phi convict threshold.</p>

<h3 id="gossipermbean">GossiperMBean</h3>
<p>The <code>org.apache.cassandra.gms.GossiperMBean</code> provides access to gossiper. The method getEndpointDowntime() can be called to know for how long a particular node has been down. Cassandra uses this value internally to know when it can discard hints for that node.</p>

<p>The getCurrentGenerationNumber operation returns the generation number associated with the specific node. The generation number is included in gossip messages exchanged between nodes and is used to distinguish the current state of a node from the state prior to restart. Each time node restarts generation number is incremented.</p>

<p>assassinateEndPoint operation removes a node from the ring by telling the other nodes that the node has been permanently removed.</p>

<h3 id="streammanagermbean">StreamManagerMBean</h3>
<p><code>org.apache.cassandra.streaming.StreamManagerMBean</code> allows us to see the streaming activities that occur between a node and peers. There are two endpoints here - stream source and a stream destination. StreamManagerMBean supports two modes of operation - getCurrentStreams operation provides a snapshot of the current incoming and outgoing streams and the MBean also publishes notification associated with teh stream state changes.</p>

<h3 id="metrics-mbeans">Metrics MBeans</h3>
<p>The ability to access metrics related to application performance health and key activities has become an essential tool for maintaining web-scale applications. Fortunately cassandra collects a wide range of metrics on its own activities to help us understand the behaviour.
Some of these are :</p>

<ul>
  <li><code>Cache Metrices</code> - Key cache/ Counter cache / Row cache - hitrate , capacity , utilization</li>
  <li><code>Client Metrices</code> such as number of connected clients and information about client requests such as latency, failures and timeouts</li>
  <li><code>Commitlog Metrices</code> such as size, stats on pending and completed tasks</li>
  <li><code>Compaction Metrices</code> such as total bytes compacted, and stats on pending and completed compactions</li>
  <li><code>Connection Metrices</code> to each node in the cluster including gossip</li>
  <li><code>Dropped message</code> metrices which are a part of nodetool tpstats</li>
  <li><code>Read repair</code> metrices describing the number of background vs blocking read repairs performed</li>
  <li><code>Storage</code> metrices including count of hints in progress and total hints</li>
  <li><code>Thread pool</code>metrices including active, completed and blocked tasks for each threadpool</li>
  <li><code>Table</code> metrices including memtables, SSTables and bloom filter usage and the latency of various read and write operations reported at one, five, and fifteen min intervals</li>
  <li><code>Keyspace</code> metrices - provide aggregate of table metrices</li>
</ul>

<h3 id="threading-mbeans">Threading MBeans</h3>
<p>The <code>org.apache.cassandra.internal</code> domain houses MBeans that allow user to configure the thread pools associated with each stage in cassandra’s staged event driven architecture. The stages include AntiEntropyStage, GossipStage, InternalResponseStage, MigrationStage and others</p>

<p>An easy way to use the jmx MBeans is via <code>nodetool</code> utility which provides access to a limited number of jmx functionalities.</p>

                        <br>
                    
                    
                    <div class="entry-tags text-center">
                    
                        <i class="icon-tags"></i>&nbsp;Tagged with <a href="/tags/index.html#Tech" data-toggle="tooltip" title="Posts tagged with Tech" rel="tag">Tech</a>&nbsp;&bull;&nbsp;<a href="/tags/index.html#Cassandra" data-toggle="tooltip" title="Posts tagged with Cassandra" rel="tag">Cassandra</a>&nbsp;&bull;&nbsp;<a href="/tags/index.html#JMX" data-toggle="tooltip" title="Posts tagged with JMX" rel="tag">JMX</a>&nbsp;&bull;&nbsp;<a href="/tags/index.html#Monitoring" data-toggle="tooltip" title="Posts tagged with Monitoring" rel="tag">Monitoring</a>&nbsp;&bull;&nbsp;<a href="/tags/index.html#Administration" data-toggle="tooltip" title="Posts tagged with Administration" rel="tag">Administration</a>&nbsp;&bull;&nbsp;<a href="/tags/index.html#Java" data-toggle="tooltip" title="Posts tagged with Java" rel="tag">Java</a>
                    
                    </div>
                    
                    </div>
        </div>
                    <footer class="post-footer entry-meta">
                        <div class="post-share text-center">
    <p class="light small">
        Share this post
    </p>
    <ul class="social-mini">
        <li>
            <a href="https://twitter.com/intent/tweet?text=&quot;JMX & Cassandra - Maintaining & Monitoring at Scale&quot;%20/tech/cassandra/jmx/monitoring/administration/java/Cassandra-JMX%20via%20&#64;beingbhuvan"
            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" data-toggle="tooltip" title="Share on Twitter" itemprop="Twitter">
                <i class="icon-twitter"></i>
            </a>
        </li>
        <li>
            <a  href="https://www.facebook.com/sharer/sharer.php?u=/tech/cassandra/jmx/monitoring/administration/java/Cassandra-JMX"
            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" data-toggle="tooltip" title="Share on Facebook" itemprop="Facebook">
                <i class="icon-facebook"></i>
            </a>
        </li>
        <li>
            <a href="https://plus.google.com/share?url=/tech/cassandra/jmx/monitoring/administration/java/Cassandra-JMX"
           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" data-toggle="tooltip" title="Share on Google plus" itemprop="GooglePlus">
                <i class="icon-google-plus"></i>
            </a>
        </li>
    </ul>
</div>
                        <div class="post-author text-center">                       
	        <img src="/images/bhuvanrawal.jpg" alt="Bhuvan Rawal's photo" itemprop="image" class="post-avatar img-circle img-responsive"/>    
	    <h4 class="bordered-bottom vcard author" itemprop="author" itemscope itemtype="http://schema.org/Person">By <span itemprop="name" class="fn"><a href="/about" title="About Bhuvan Rawal" itemprop="url">Bhuvan Rawal</a></span></h4>
	    <p>Bhuvan Rawal is a Computer Science engineer based in New Delhi, India. His interests are anything that&#8217;s related to Technology and Science, from math to programming languages to music to physics to engineering to philosophy.</p>
</div> 
                        <div id="disqus_thread"></div><!-- /#disqus_thread -->
                    </footer>
            </article>
    </div>
</div>

<footer id="footer"  class="blog-background overlay text-center align-middle animated from-top" style="background-image: url(/images/default_bg1.jpg)" >


    <div class="inner">
        <div class="container">

            <ul class="social-icons">
            <li>
                <a href="http://twitter.com/beingbhuvan" data-toggle="tooltip" title="Bhuvan Rawal on Twitter" target="_blank">
                    <i class="icon-twitter"></i>
                </a>
            </li>
            <li>
                <a href="http://facebook.com/bhu1rawal" data-toggle="tooltip" title="Bhuvan Rawal on Facebook" target="_blank">
                    <i class="icon-facebook"></i>
                </a>
            </li>
            <li>
                <a href="https://plus.google.com/u/0/115368800868963120427" data-toggle="tooltip" title="Bhuvan Rawal on Google+" target="_blank">
                    <i class="icon-google-plus"></i>
                </a>
            </li>
            <li>
                <a href="https://stackexchange.com/users/4482379/bhuvan-rawal" data-toggle="tooltip" title="Bhuvan Rawal on StackExchange" target="_blank">
                    <i class="icon-stackexchange"></i>
                </a>
            </li>
            <li>
                <a href="https://in.linkedin.com/in/bhuvanrawal" data-toggle="tooltip" title="Bhuvan Rawal on LinkedIn" target="_blank">
                    <i class="icon-linkedin"></i>
                </a>
            </li>
            
            
            <li>
                <a href="http://github.com/bhuvanrawal" data-toggle="tooltip" title="Bhuvan Rawal on Github" target="_blank">
                    <i class="icon-github"></i>
                </a>
            </li>
        </ul>
            <div>
                <a href="/about/">Bhuvan Rawal</a> &copy; 2016 &bull; All rights reserved.
            </div>
            <ul class="menu-items">
            
            <li>
                
                    <a href="/"><i class="icon-home"></i></a>&nbsp;&bull;
                 
            </li>
            
            <li>
                
                    <a href="/categories">Categories</a>&nbsp;&bull;
                 
            </li>
            
            <li>
                
                    <a href="/tags">Tags</a>&nbsp;&bull;
                 
            </li>
            
            <li>
                
                    <a href="/about">Bhuvan who?</a>&nbsp;&bull;
                 
            </li>
            
            <li>
                
                    <a href="/contact">Contact me</a>&nbsp;&bull;
                 
            </li>
            
            <li>
                
                    <a href="/resume">Resume</a>&nbsp;&bull;
                 
            </li>
            
            <li><a href="/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
        </ul>
        </div>
    </div>
    
        <div class="decor-wrapper">
            <svg id="footer-decor" class="decor top" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" preserveAspectRatio="none">

                <path class="large left" d="M0 0 L50 50 L0 100" fill="rgba(255,255,255, .1)"></path>
                <path class="large right" d="M100 0 L50 50 L100 100" fill="rgba(255,255,255, .1)"></path>

                <path class="medium left" d="M0 0 L50 50 L0 66.6" fill="rgba(255,255,255, .3)"></path>
                <path class="medium right" d="M100 0 L50 50 L100 66.6" fill="rgba(255,255,255, .3)"></path>

                <path class="small left" d="M0 0 L50 50 L0 33.3" fill="rgba(255,255,255, .5)"></path>
                <path class="small right" d="M100 0 L50 50 L100 33.3" fill="rgba(255,255,255, .5)"></path>

                <path d="M0 0 L50 50 L100 0 L0 0" fill="rgba(255,255,255, 1)"></path>

                <path d="M48 48 L50 51 L52 48 L48 48" fill="rgba(255,255,255, 1)"></path>

            </svg>
        </div>
    

</footer>

    
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>
<script type="text/javascript" src="/assets/js/waypoints.min.js"></script>
<script type="text/javascript" src="/assets/js/script.js"></script>
<script type='text/javascript'>$(document).ready(function(){$(".time").text(function(a,b){return Math.round(parseFloat(b))})});</script>

<script type="text/javascript" src="/assets/js/custom.js"></script>

<script type="text/javascript">

/*      Slides       */

$("a#slide").click(function(){
    $("#sidebar,body,a#slide,#fade").addClass("slide")
});

$("#fade,#header,#posts-container").click(function(){
    $("#sidebar,body,a#slide,#fade").removeClass("slide")
});

$("a#click-filter").click(function(){
    $("#slide-filter").slideToggle("medium");
    $("#slide-pages").slideOut("medium");
});

$("a#click-pages").click(function(){
    $("#slide-pages").slideToggle("medium");
    $("#slide-filter").slideOut("medium");
});

/*      End-Slides      */

</script>


<!-- Jekyll Simple Search option -->
<script>
  $(document).ready(function() {
      $('.search-field').simpleJekyllSearch({
          jsonFile : '/search.json',
          searchResults : '.search-results',
          template : '<li><article><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></article></li>',
          noResults: '<p>Nothing found.</p>'
        });
  });

  (function( $, window, undefined ) {
    
     var bs = {
          close: $(".icon-remove-sign"),
          searchform: $(".search-form"),
          canvas: $("body"),
          dothis: $('.dosearch')
      };
    
    bs.dothis.on('click', function() {
      $('.search-wrapper').css({ display: "block" });
      bs.searchform.toggleClass('active');
      bs.searchform.find('input').focus();
      bs.canvas.toggleClass('search-overlay');
    });
    
      bs.close.on('click', function() {
        $('.search-wrapper').removeAttr( 'style' );
        bs.searchform.toggleClass('active');
        bs.canvas.removeClass('search-overlay');
    });
  })( jQuery, window );
</script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl = 
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-58286706-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'bhuvanrawal'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
 
</body>
</html>
